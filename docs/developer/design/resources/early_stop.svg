<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="718px" preserveAspectRatio="none" style="width:714px;height:718px;background:#FFFFFF;" version="1.1" viewBox="0 0 714 718" width="714px" zoomAndPan="magnify"><defs/><g><rect fill="none" height="525.3906" style="stroke:#000000;stroke-width:1.5;" width="698.5" x="10" y="140.6953"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="56" x2="56" y1="36.2969" y2="683.0859"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="276.5" x2="276.5" y1="36.2969" y2="683.0859"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="366.5" x2="366.5" y1="36.2969" y2="683.0859"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="659.5" x2="659.5" y1="36.2969" y2="683.0859"/><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="72" x="20" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="58" x="27" y="24.9951">SLModel</text><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="72" x="20" y="682.0859"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="58" x="27" y="702.0811">SLModel</text><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="65" x="244.5" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="51" x="251.5" y="24.9951">SLBase</text><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="65" x="244.5" y="682.0859"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="51" x="251.5" y="702.0811">SLBase</text><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="94" x="319.5" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="80" x="326.5" y="24.9951">CallbackList</text><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="94" x="319.5" y="682.0859"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="80" x="326.5" y="702.0811">CallbackList</text><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="78" x="620.5" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="64" x="627.5" y="24.9951">EarlyStop</text><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="78" x="620.5" y="682.0859"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="64" x="627.5" y="702.0811">EarlyStop</text><polygon fill="#181818" points="265,63.4297,275,67.4297,265,71.4297,269,67.4297" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="56" x2="271" y1="67.4297" y2="67.4297"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="159" x="63" y="62.3638">拉起各个节点的训练worker</text><polygon fill="#181818" points="354.5,92.5625,364.5,96.5625,354.5,100.5625,358.5,96.5625" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="56" x2="360.5" y1="96.5625" y2="96.5625"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="204" x="63" y="91.4966">通过CallbackList拉起各个callback</text><polygon fill="#181818" points="647.5,121.6953,657.5,125.6953,647.5,129.6953,651.5,125.6953" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="366.5" x2="653.5" y1="125.6953" y2="125.6953"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="225" x="373.5" y="120.6294">(EarlyStop持有slmode的worker对象)</text><path d="M10,140.6953 L154,140.6953 L154,147.8281 L144,157.8281 L10,157.8281 L10,140.6953 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="525.3906" style="stroke:#000000;stroke-width:1.5;" width="698.5" x="10" y="140.6953"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="99" x="25" y="153.7622">train_process</text><polygon fill="#181818" points="265,174.9609,275,178.9609,265,182.9609,269,178.9609" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="56" x2="271" y1="178.9609" y2="178.9609"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="79" x="63" y="173.895">handle_data</text><polygon fill="#181818" points="354.5,204.0938,364.5,208.0938,354.5,212.0938,358.5,208.0938" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="56" x2="360.5" y1="208.0938" y2="208.0938"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="172" x="63" y="203.0278">on_train_begin设置内部变量</text><polygon fill="#181818" points="647.5,233.2266,657.5,237.2266,647.5,241.2266,651.5,237.2266" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="366.5" x2="653.5" y1="237.2266" y2="237.2266"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="150" x="373.5" y="232.1606">初始化earlystop内部变量</text><polygon fill="#181818" points="265,262.3594,275,266.3594,265,270.3594,269,266.3594" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="56" x2="271" y1="266.3594" y2="266.3594"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="85" x="63" y="261.2935">base_forward</text><polygon fill="#181818" points="265,291.4922,275,295.4922,265,299.4922,269,295.4922" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="56" x2="271" y1="295.4922" y2="295.4922"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="55" x="63" y="290.4263">agglayer</text><polygon fill="#181818" points="265,320.625,275,324.625,265,328.625,269,324.625" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="56" x2="271" y1="324.625" y2="324.625"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="55" x="63" y="319.5591">fuse_net</text><polygon fill="#181818" points="265,349.7578,275,353.7578,265,357.7578,269,353.7578" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="56" x2="271" y1="353.7578" y2="353.7578"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="98" x="63" y="348.6919">base_backward</text><polygon fill="#181818" points="265,378.8906,275,382.8906,265,386.8906,269,382.8906" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="56" x2="271" y1="382.8906" y2="382.8906"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="130" x="63" y="377.8247">evaluate [validation]</text><polygon fill="#181818" points="354.5,408.0234,364.5,412.0234,354.5,416.0234,358.5,412.0234" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="56" x2="360.5" y1="412.0234" y2="412.0234"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="79" x="63" y="406.9575">on_test_end</text><polygon fill="#181818" points="647.5,437.1563,657.5,441.1563,647.5,445.1563,651.5,441.1563" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="366.5" x2="653.5" y1="441.1563" y2="441.1563"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="79" x="373.5" y="436.0903">on_test_end</text><polygon fill="#181818" points="288,466.2891,278,470.2891,288,474.2891,284,470.2891" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="282" x2="658.5" y1="470.2891" y2="470.2891"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="91" x="294" y="465.2231">获取运行时数据</text><polygon fill="#181818" points="647.5,495.4219,657.5,499.4219,647.5,503.4219,651.5,499.4219" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="277" x2="653.5" y1="499.4219" y2="499.4219"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="137" x="284" y="494.356">更新earlystop内部变量</text><polygon fill="#181818" points="354.5,524.5547,364.5,528.5547,354.5,532.5547,358.5,528.5547" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="56" x2="360.5" y1="528.5547" y2="528.5547"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="93" x="63" y="523.4888">on_epoch_end</text><polygon fill="#181818" points="647.5,553.6875,657.5,557.6875,647.5,561.6875,651.5,557.6875" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="366.5" x2="653.5" y1="557.6875" y2="557.6875"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="269" x="373.5" y="552.6216">on_epoch_end 根据metrics，更新earlystop</text><polygon fill="#181818" points="288,582.8203,278,586.8203,288,590.8203,284,586.8203" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="282" x2="658.5" y1="586.8203" y2="586.8203"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="91" x="294" y="581.7544">获取运行时数据</text><polygon fill="#181818" points="647.5,611.9531,657.5,615.9531,647.5,619.9531,651.5,615.9531" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="277" x2="653.5" y1="615.9531" y2="615.9531"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="321" x="284" y="610.8872">更新earlystop内部变量，并判断更新是否stop training</text><line style="stroke:#181818;stroke-width:1.0;" x1="56" x2="98" y1="645.0859" y2="645.0859"/><line style="stroke:#181818;stroke-width:1.0;" x1="98" x2="98" y1="645.0859" y2="658.0859"/><line style="stroke:#181818;stroke-width:1.0;" x1="57" x2="98" y1="658.0859" y2="658.0859"/><polygon fill="#181818" points="67,654.0859,57,658.0859,67,662.0859,63,658.0859" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="207" x="63" y="640.02">判断是否退出，并调用save_model</text><!--MD5=[c312f0106be0685c6db0c776b34e62ab]
@startuml
SLModel->SLBase: 拉起各个节点的训练worker
SLModel->CallbackList: 通过CallbackList拉起各个callback
CallbackList->EarlyStop:  (EarlyStop持有slmode的worker对象)
group train_process
	SLModel->SLBase: handle_data
	SLModel->CallbackList:on_train_begin设置内部变量
	CallbackList->EarlyStop:初始化earlystop内部变量

	SLModel->SLBase: base_forward
	SLModel->SLBase: agglayer
	SLModel->SLBase: fuse_net
	SLModel->SLBase: base_backward


	SLModel->SLBase:evaluate [validation]
	SLModel->CallbackList:on_test_end
	CallbackList->EarlyStop:on_test_end
  EarlyStop->SLBase:获取运行时数据
  SLBase->EarlyStop: 更新earlystop内部变量

	SLModel->CallbackList:on_epoch_end
  CallbackList->EarlyStop:on_epoch_end 根据metrics，更新earlystop
  EarlyStop->SLBase:获取运行时数据
  SLBase->EarlyStop: 更新earlystop内部变量，并判断更新是否stop training
	SLModel -> SLModel: 判断是否退出，并调用save_model
end
@enduml

PlantUML version 1.2022.7(Mon Aug 22 17:01:30 UTC 2022)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: null
--></g></svg>